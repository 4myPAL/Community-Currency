<html lang="en">
<head>
  <title>Address Book</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script type="text/javascript">

</script>
  <style>
    /* Remove the navbar's default margin-bottom and rounded borders */ 
    .navbar {
      margin-bottom: 0;
      border-radius: 0;
    }
    
 </style>
</head>
<body>


<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span> 
      </button>
    <a class="navbar-brand" href="https://github.com/segovro/Community-Currency" target="blank">EthCC Community Currency </a>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav">
      	<li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="index.html"><span class="glyphicon glyphicon-piggy-bank"></span> Wallet</a>
          <ul class="dropdown-menu">
          	<li><a href="index.html"><span class="glyphicon glyphicon-plus"></span> Account balance</a></li>
          	<li><a href="creditLine.html"><span class="glyphicon glyphicon-minus"></span> Credit line</a></li>
          	<li><a href="payment.html"><span class="glyphicon glyphicon-send"></span> Payment</a></li> 
        	<li><a href="transactions.html"><span class="glyphicon glyphicon-transfer"></span> Transactions</a></li>        	
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="monitor.html"><span class="glyphicon glyphicon-thumbs-up"></span> Trust</a>
          <ul class="dropdown-menu">
          	<li><a href="access.html"><span class="glyphicon glyphicon-log-in"></span> Give access</a></li> 
        	<li><a href="monitor.html"><span class="glyphicon glyphicon-eye-open"></span> Monitor account</a></li> 
        	<li><a href="endorseCredit.html"><span class="glyphicon glyphicon-check"></span> Endorse P2P Credit</a></li> 
          </ul>
        </li>
        <li class="active"><a href="addressBook.html"><span class="glyphicon glyphicon-book"></span> Address book</a></li> 
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="management.html"><span class="glyphicon glyphicon-menu-hamburger"></span>  Management</a>
          <ul class="dropdown-menu">
        	<li><a href="community.html"><span class="glyphicon glyphicon-flag"></span> Community</a></li> 
        	<li><a href="treasury.html"><span class="glyphicon glyphicon-lock"></span> Treasury</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>
  
<div class="container bg-3 text-center">    
	 <div class="row">
	 	<div class="col-sm-4"> 
	 	
	 		<h3><span class="glyphicon glyphicon-user"></span> Edit Contact</h3>
			<form role="form" id="contacts-form">
				<div class="item text">
					<label for="alias">Alias:</label>
					<div class="field"><input type="text" class="form-control" name="alias" placeholder="Enter alias" /></div>
				</div>
				<div class="item text">
					<label for="account">Account:</label>
					<div class="field"><input type="text" class="form-control" name="account" placeholder="Enter account" /></div>
				</div>
				<div class="item text">
					<label for="email">Email:</label>
					<div class="field"><input type="text" class="form-control" name="email" placeholder="Enter email" /></div>
				</div>
				<br/>
				<div class="btn-group">
					<button type="submit" class="btn btn-default" id="contacts-op-discard" value="Discard" ><span class="glyphicon glyphicon-remove"></span> Discard</button>
					<button type="submit" class="btn btn-default" id="contacts-op-save" value="Save" ><span class="glyphicon glyphicon-ok"></span> Save</button>
				</div>
				<input type="hidden" name="id_entry" value="0" />
				<br/>
			</form>
		</div>
		<br/>
		<div class="col-sm-8"> 			   
		<h3><span class="glyphicon glyphicon-book"></span> Address Book</h3> 
		<table class="table table-striped" id="contacts-table">
		<thead>
			<tr id="contacts-head">
				<th>ID</th>
				<th>Alias</th>
				<th>Account</th>
				<th>Email</th>
				<th>Actions</th>
			</tr>
		</thead>
		</table>
		</div>
		

			
	</div>
</div>


<script>
		var Contacts = {
			index: window.localStorage.getItem("Contacts:index"),
			$table: document.getElementById("contacts-table"),
			$form: document.getElementById("contacts-form"),
			$button_save: document.getElementById("contacts-op-save"),
			$button_discard: document.getElementById("contacts-op-discard"),

			init: function() {
				// initialize storage index
				if (!Contacts.index) {
					window.localStorage.setItem("Contacts:index", Contacts.index = 1);
				}

				// initialize form
				Contacts.$form.reset();
				Contacts.$button_discard.addEventListener("click", function(event) {
					Contacts.$form.reset();
					Contacts.$form.id_entry.value = 0;
				}, true);
				Contacts.$form.addEventListener("submit", function(event) {
					var entry = {
						id: parseInt(this.id_entry.value),
						alias: this.alias.value,
						account: this.account.value,
						email: this.email.value
					};
					if (entry.id == 0) { // add
						Contacts.storeAdd(entry);
						Contacts.tableAdd(entry);
					}
					else { // edit
						Contacts.storeEdit(entry);
						Contacts.tableEdit(entry);
					}

					this.reset();
					this.id_entry.value = 0;
					event.preventDefault();
				}, true);

				// initialize table
				if (window.localStorage.length - 1) {
					var contacts_list = [], i, key;
					for (i = 0; i < window.localStorage.length; i++) {
						key = window.localStorage.key(i);
						if (/Contacts:\d+/.test(key)) {
							contacts_list.push(JSON.parse(window.localStorage.getItem(key)));
						}
					}

					if (contacts_list.length) {
						contacts_list
							.sort(function(a, b) {
								return a.id < b.id ? -1 : (a.id > b.id ? 1 : 0);
							})
							.forEach(Contacts.tableAdd);
					}
				}
				Contacts.$table.addEventListener("click", function(event) {
					var op = event.target.getAttribute("data-op");
					if (/edit|remove/.test(op)) {
						var entry = JSON.parse(window.localStorage.getItem("Contacts:"+ event.target.getAttribute("data-id")));
						if (op == "edit") {
							Contacts.$form.alias.value = entry.alias;
							Contacts.$form.account.value = entry.account;
							Contacts.$form.email.value = entry.email;
							Contacts.$form.id_entry.value = entry.id;
						}
						else if (op == "remove") {
							if (confirm('Are you sure you want to remove "'+ entry.alias +' '+ entry.account +'" from your contacts?')) {
								Contacts.storeRemove(entry);
								Contacts.tableRemove(entry);
							}
						}
						event.preventDefault();
					}
				}, true);
			},

			storeAdd: function(entry) {
				entry.id = Contacts.index;
				window.localStorage.setItem("Contacts:index", ++Contacts.index);
				window.localStorage.setItem("Contacts:"+ entry.id, JSON.stringify(entry));
			},
			storeEdit: function(entry) {
				window.localStorage.setItem("Contacts:"+ entry.id, JSON.stringify(entry));
			},
			storeRemove: function(entry) {
				window.localStorage.removeItem("Contacts:"+ entry.id);
			},

			tableAdd: function(entry) {
				var $tr = document.createElement("tr"), $td, key;
				for (key in entry) {
					if (entry.hasOwnProperty(key)) {
						$td = document.createElement("td");
						$td.appendChild(document.createTextNode(entry[key]));
						$tr.appendChild($td);
					}
				}
				$td = document.createElement("td");
				$td.innerHTML = '<a data-op="edit" data-id="'+ entry.id +'">Edit</a> | <a data-op="remove" data-id="'+ entry.id +'">Remove</a>';
				$tr.appendChild($td);
				$tr.setAttribute("id", "entry-"+ entry.id);
				Contacts.$table.appendChild($tr);
			},
			tableEdit: function(entry) {
				var $tr = document.getElementById("entry-"+ entry.id), $td, key;
				$tr.innerHTML = "";
				for (key in entry) {
					if (entry.hasOwnProperty(key)) {
						$td = document.createElement("td");
						$td.appendChild(document.createTextNode(entry[key]));
						$tr.appendChild($td);
					}
				}
				$td = document.createElement("td");
				$td.innerHTML = '<a data-op="edit" data-id="'+ entry.id +'">Edit</a> | <a data-op="remove" data-id="'+ entry.id +'">Remove</a>';
				$tr.appendChild($td);
			},
			tableRemove: function(entry) {
				Contacts.$table.removeChild(document.getElementById("entry-"+ entry.id));
			}
		};
		Contacts.init();
	</script>
</body>
</html>

